webpackJsonp([0xaa4d4e6d63c5],{657:function(n,s){n.exports={data:{site:{siteMetadata:{title:"(shatteredaesthetic)",author:"Jason Polhemus"}},markdownRemark:{id:"/Users/travis/build/shatteredaesthetic/shatteredaesthetic.github.io/content/what-the-adt-01.md absPath of file >>> MarkdownRemark",html:'<h2>Part 1: Let’s Get Logical…Logical</h2>\n<p>Welcome back! Last time we … well, we didn’t do much of anything. We stated our purpose: a number-guessing game. All the code is <a href="https://github.com/shatteredaesthetic/cipher-guess">in this repo</a>, in the <code class="language-text">what-adt-01</code> branch, if you’d like to follow along. With that, let’s begin!</p>\n<h4>To Begin at the Beginning…</h4>\n<p>To begin, we should probably talk about what we want to achieve. How do we want to model the logic branching? We’re going to take user input, so the first thing we should do is make sure what we’re given was what we asked for. Sometimes users can be … <em>special</em> … and we need to handle that appropriately.</p>\n<p>How does <code class="language-text">Either</code> play into this? <code class="language-text">Either</code> is the canonical sum type, meaning it has two constructors, and the value of the type is <em>either</em> one constructor or the other. <code class="language-text">Either</code>’s constructors are <code class="language-text">Right</code> and <code class="language-text">Left</code>. We’ll use <code class="language-text">Left</code> for all wrong answers and <code class="language-text">Right</code> to pass the value along.</p>\n<blockquote>\n<p><strong>Theory Aside</strong></p>\n<p><code class="language-text">Either</code>’s data type looks like</p>\n<div class="gatsby-highlight">\n      <pre class="language-haskell"><code class="language-haskell"><span class="token keyword">data</span> <span class="token constant">Either</span> <span class="token hvariable">b</span> <span class="token hvariable">a</span> <span class="token operator">=</span> <span class="token constant">Left</span> <span class="token hvariable">b</span> <span class="token operator">|</span> <span class="token constant">Right</span> <span class="token hvariable">a</span></code></pre>\n      </div>\n<p>Since we’ll be <code class="language-text">chain</code>ing on the <code class="language-text">Either</code>s, errors will go into <code class="language-text">Left</code>s. Trying to <code class="language-text">chain</code> on a <code class="language-text">Left</code> just returns the <code class="language-text">Left</code>. Excellent!</p>\n</blockquote>\n<p>So, step one is to validate the input. Now we need to check if the guess is within the tolerance, and if equals the target exactly. That will be our step two and three, respectively.</p>\n<h4>Enough planning, Let’s write some code</h4>\n<p>So, like all modern epics, we start by importing some essentials.</p>\n<div class="gatsby-highlight">\n      <pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token punctuation">{</span> Either <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'crocks\'</span><span class="token punctuation">)</span>\n<span class="token keyword">const</span> <span class="token punctuation">{</span> Right<span class="token punctuation">,</span> Left <span class="token punctuation">}</span> <span class="token operator">=</span> Either</code></pre>\n      </div>\n<p>Since we’re modeling logic with <code class="language-text">Either</code>, let’s import it from <code class="language-text">crocks</code>. We extract <code class="language-text">Right</code> and <code class="language-text">Left</code> from <code class="language-text">Either</code> just as a convenience, and to reduce typing.</p>\n<p>With this in place, let’s start on our validating first step:</p>\n<div class="gatsby-highlight">\n      <pre class="language-js"><code class="language-js"><span class="token comment">// firstTest : Int -> Either String Int</span>\n<span class="token keyword">const</span> <span class="token function-variable function">firstTest</span> <span class="token operator">=</span> n <span class="token operator">=></span>\n  <span class="token number">1</span> <span class="token operator">&lt;=</span> n <span class="token operator">&amp;&amp;</span> n <span class="token operator">&lt;=</span> <span class="token number">100</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">isNaN</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span>\n    <span class="token operator">?</span> <span class="token function">Right</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span>\n    <span class="token punctuation">:</span> <span class="token function">Left</span><span class="token punctuation">(</span><span class="token string">\'You need to learn to follow instructions\'</span><span class="token punctuation">)</span></code></pre>\n      </div>\n<p>So, in our first test, we’ll want to validate the user input <code class="language-text">n</code>. We will be asking for an integer between 1 and 100, so we’ll want to be sure that the input is both an integer and within the range we asked for. We’ll put a validated input into a <code class="language-text">Right</code>, allowing it to proceed to the next test. Anything invalid is put into a <code class="language-text">Left</code> with our pithy response, bypassing the rest of the tests. No need to check if ‘a’ is between 1 and 100, right? What is this, ASCII?</p>\n<div class="gatsby-highlight">\n      <pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token punctuation">{</span> taggedSum <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'daggy\'</span><span class="token punctuation">)</span>\n\n<span class="token keyword">const</span> Ord <span class="token operator">=</span> <span class="token function">taggedSum</span><span class="token punctuation">(</span><span class="token string">\'Ord\'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n  LT<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n  EQ<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n  GT<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre>\n      </div>\n<p>This next section includes a twist! We’re going to introduce a new sum type, and for that we’ll need to import <code class="language-text">daggy</code>. Our new type will be the union of possibilities of comparing two integers: less than (<code class="language-text">Ord.LT</code>), greater than (<code class="language-text">Ord.GT</code>), or equal to (<code class="language-text">Ord.EQ</code>). As you’ve probably divined, we are going to call this type <code class="language-text">Ord</code>, after the same type from haskell.</p>\n<blockquote>\n<p><strong>Theory Aside</strong></p>\n<p><code class="language-text">Either</code> is the canonical sum type because it has the least number of different constructors, 2. But we can make our own sum type with any number of constructors. For <code class="language-text">Ord</code>, we have 3.</p>\n</blockquote>\n<p>Why do we need this? It helps us to model our signal flow nicely. Let’s look at the next test:</p>\n<div class="gatsby-highlight">\n      <pre class="language-js"><code class="language-js"><span class="token keyword">const</span> branch <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'crocks/Pair/branch\'</span><span class="token punctuation">)</span>\n\n<span class="token comment">// isTolerant : (Int, Int) -> Int -> Eq</span>\n<span class="token keyword">const</span> <span class="token function-variable function">isTolerant</span> <span class="token operator">=</span> <span class="token punctuation">(</span>low<span class="token punctuation">,</span> high<span class="token punctuation">)</span> <span class="token operator">=></span> n <span class="token operator">=></span>\n  n <span class="token operator">&lt;</span> low <span class="token operator">?</span> Ord<span class="token punctuation">.</span>LT <span class="token punctuation">:</span> n <span class="token operator">></span> high <span class="token operator">?</span> Ord<span class="token punctuation">.</span>GT <span class="token punctuation">:</span> Ord<span class="token punctuation">.</span>EQ\n\n<span class="token comment">// secondTest : Env -> Int -> Either String Int</span>\n<span class="token keyword">const</span> <span class="token function-variable function">secondTest</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> target<span class="token punctuation">,</span> tolerance <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=></span> n <span class="token operator">=></span>\n  <span class="token function">branch</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span>\n    <span class="token punctuation">.</span><span class="token function">bimap</span><span class="token punctuation">(</span>x <span class="token operator">=></span> x <span class="token operator">-</span> tolerance<span class="token punctuation">,</span> x <span class="token operator">=></span> x <span class="token operator">+</span> tolerance<span class="token punctuation">)</span>\n    <span class="token punctuation">.</span><span class="token function">merge</span><span class="token punctuation">(</span>isTolerant<span class="token punctuation">)</span>\n    <span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span>\n    <span class="token punctuation">.</span><span class="token function">cata</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n      LT<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">Left</span><span class="token punctuation">(</span><span class="token string">\'Too Low\'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n      EQ<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">Right</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">,</span>\n      GT<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">Left</span><span class="token punctuation">(</span><span class="token string">\'Too High\'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre>\n      </div>\n<p>In this test, we are checking to see if the guess is within the accepted tolerance, or whether it is too high or too low. This is accomplished with the <code class="language-text">isTolerant</code> function. Now…what is going on with <code class="language-text">secondTest</code>?</p>\n<p>We’re using a <code class="language-text">Pair</code> and some interesting helpers from <code class="language-text">crocks</code> here. First, we branch the target. This gives us a <code class="language-text">Pair</code> with the target in both positions. Then, we bimap, using each function to map its respective target. Then, we merge them, supplying <code class="language-text">isTolerant</code> with it’s <code class="language-text">low</code> and <code class="language-text">high</code> parameters, returning a function. We <code class="language-text">call</code> that function with our number, <code class="language-text">n</code>, returning our <code class="language-text">Ord</code>.</p>\n<p>This may help:</p>\n<div class="gatsby-highlight">\n      <pre class="language-js"><code class="language-js"><span class="token function">branch</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span> <span class="token comment">// Pair Int Int</span>\n  <span class="token punctuation">.</span><span class="token function">bimap</span><span class="token punctuation">(</span>x <span class="token operator">=></span> x <span class="token operator">-</span> tolerance<span class="token punctuation">,</span> x <span class="token operator">=></span> x <span class="token operator">+</span> tolerance<span class="token punctuation">)</span> <span class="token comment">// Pair Int Int</span>\n  <span class="token punctuation">.</span><span class="token function">merge</span><span class="token punctuation">(</span>isTolerant<span class="token punctuation">)</span> <span class="token comment">// Function: Int -> Ord</span>\n  <span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span> <span class="token comment">// Ord</span>\n  <span class="token punctuation">.</span><span class="token function">cata</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n    LT<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">Left</span><span class="token punctuation">(</span><span class="token string">\'Too Low\'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// ...</span>\n    EQ<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">Right</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// ...</span>\n    GT<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">Left</span><span class="token punctuation">(</span><span class="token string">\'Too High\'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// Either String Int</span></code></pre>\n      </div>\n<p>This last function, <code class="language-text">cata</code>, is a method returned from every sum type you make from <code class="language-text">daggy</code>. It allows you to pattern match on your sum type’s constructors. We use this to set the result of our test, passing a number within the tolerance to the <code class="language-text">Right</code>, and a number outside of it to the <code class="language-text">Left</code>, giving it the appropriate result string.</p>\n<p>So far, so good…one more test to go:</p>\n<div class="gatsby-highlight">\n      <pre class="language-js"><code class="language-js"><span class="token comment">// thirdTest : Env -> Int -> Either String String</span>\n<span class="token keyword">const</span> <span class="token function-variable function">thirdTest</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> target <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=></span> n <span class="token operator">=></span>\n  target <span class="token operator">===</span> n <span class="token operator">?</span> <span class="token function">Right</span><span class="token punctuation">(</span><span class="token string">\'Win\'</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token function">Right</span><span class="token punctuation">(</span><span class="token string">\'Close Enough\'</span><span class="token punctuation">)</span></code></pre>\n      </div>\n<p>The last test is a check to see if our player exactly guessed the number. We check that the guess is equal to the target, returning a <code class="language-text">Right</code> if it is, and a…<code class="language-text">Right</code> if it isn’t? You read that right: either way it’s a winning guess; but maybe (hint, hint)(or is it branch(hint)?) we’ll want to score them differently…but for now we’ll just give both their own result string.</p>\n<h4>Cool, Three tests…now what?</h4>\n<p>Those three tests seem to be all we need, but how do we put them together? Let’s look at those type signatures again:</p>\n<div class="gatsby-highlight">\n      <pre class="language-js"><code class="language-js"><span class="token comment">// firstTest : Int -> Either String Int</span>\n<span class="token comment">// secondTest : Env -> Int -> Either String Int</span>\n<span class="token comment">// thirdTest : Env -> Int -> Either String String</span></code></pre>\n      </div>\n<p>Ignoring the <code class="language-text">Env</code> for the second two tests for a second, those type signatures are pretty similar. it seems we take a <code class="language-text">b</code> and return an <code class="language-text">Either a b</code>, then we take that <code class="language-text">b</code> and return another <code class="language-text">Either a b</code>. Finally, we take that <code class="language-text">b</code> and return a final <code class="language-text">Either a b</code>. There’s a function for that, turns out: <code class="language-text">chain</code>.</p>\n<div class="gatsby-highlight">\n      <pre class="language-js"><code class="language-js"><span class="token comment">// runTests : Env -> Int -> Either String Int</span>\n<span class="token keyword">const</span> <span class="token function-variable function">runTests</span> <span class="token operator">=</span> env <span class="token operator">=></span> n <span class="token operator">=></span>\n  Either<span class="token punctuation">.</span><span class="token keyword">of</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span>\n    <span class="token punctuation">.</span><span class="token function">chain</span><span class="token punctuation">(</span>firstTest<span class="token punctuation">)</span>\n    <span class="token punctuation">.</span><span class="token function">chain</span><span class="token punctuation">(</span><span class="token function">secondTest</span><span class="token punctuation">(</span>env<span class="token punctuation">)</span><span class="token punctuation">)</span>\n    <span class="token punctuation">.</span><span class="token function">chain</span><span class="token punctuation">(</span><span class="token function">thirdTest</span><span class="token punctuation">(</span>env<span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>\n      </div>\n<p>This is one way to go, but we can do better. <code class="language-text">crocks</code> has a handy kleisli composition function, <code class="language-text">composeK</code>, that would allow us to be a bit more pointfree. However, we’re going to use <code class="language-text">pipeK</code> instead, since it reads nicer here, and it’s only <code class="language-text">composeK</code> backwards.</p>\n<div class="gatsby-highlight">\n      <pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token punctuation">{</span> pipeK <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'crocks\'</span><span class="token punctuation">)</span>\n\n<span class="token comment">// runTests : Env -> Int -> Either String Int</span>\n<span class="token keyword">const</span> <span class="token function-variable function">runTests</span> <span class="token operator">=</span> env <span class="token operator">=></span>\n  <span class="token function">pipeK</span><span class="token punctuation">(</span>Either<span class="token punctuation">.</span><span class="token keyword">of</span><span class="token punctuation">,</span> firstTest<span class="token punctuation">,</span> <span class="token function">secondTest</span><span class="token punctuation">(</span>env<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">thirdTest</span><span class="token punctuation">(</span>env<span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>\n      </div>\n<p>Now, we just feed <code class="language-text">runTests</code> with an <code class="language-text">env</code> and an int, and we’ll get back an <code class="language-text">Either String String</code> holding our result.</p>\n<p>So, what’s with all this ‘env’ stuff? There are some variables that are global, that we’d like to have in the tests, but we’re trying to be all functional and such, so we can’t have something as simple as global variables. No, we keeps our functions pure.</p>\n<h4>We need us some Config Magic</h4>\n<p>So, what’re we to do? Enter: the <code class="language-text">Reader</code>. <code class="language-text">Reader</code> wraps a function from an environment to any type. In typespeak, that’s</p>\n<div class="gatsby-highlight">\n      <pre class="language-haskell"><code class="language-haskell"><span class="token keyword">newtype</span> <span class="token constant">Reader</span> <span class="token hvariable">e</span> <span class="token hvariable">a</span> <span class="token operator">=</span> <span class="token constant">Reader</span> <span class="token punctuation">{</span> <span class="token hvariable">runWith</span> <span class="token operator">:</span> <span class="token hvariable">e</span> <span class="token operator">-></span> <span class="token hvariable">a</span> <span class="token punctuation">}</span></code></pre>\n      </div>\n<p>which, in javascript, I guess would be something like</p>\n<div class="gatsby-highlight">\n      <pre class="language-js"><code class="language-js"><span class="token comment">// Reader : (e -> a) -> { runWith : e -> a }</span></code></pre>\n      </div>\n<blockquote>\n<p><code class="language-text">Reader</code> is a newtype wrapper around a unary function. It takes a function from an environment to a type, and returns a <code class="language-text">Reader</code> with a method called <code class="language-text">runWith</code> that, you guessed it, runs the <code class="language-text">Reader</code> with an environment. In Javascript that means, you guessed it, an object!</p>\n</blockquote>\n<p>We get a cool function with <code class="language-text">Reader</code>, called <code class="language-text">ask</code>. <code class="language-text">ask</code> returns the environment, allowing you to map over it, which is exactly what we’ll do.</p>\n<div class="gatsby-highlight">\n      <pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token punctuation">{</span> pipe <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'crocks\'</span><span class="token punctuation">)</span>\n<span class="token keyword">const</span> runWith <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'crocks/pointfree/runWith\'</span><span class="token punctuation">)</span>\n\n<span class="token comment">// gameLogic : Either String Int -> Reader (Either String String)</span>\n<span class="token keyword">const</span> <span class="token function-variable function">gameLogic</span> <span class="token operator">=</span> either <span class="token operator">=></span> Reader<span class="token punctuation">.</span><span class="token function">ask</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>env <span class="token operator">=></span> either<span class="token punctuation">.</span><span class="token function">chain</span><span class="token punctuation">(</span><span class="token function">runTests</span><span class="token punctuation">(</span>env<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n\n<span class="token comment">// logic : Env -> Int -> Either String String)</span>\n<span class="token keyword">const</span> <span class="token function-variable function">logic</span> <span class="token operator">=</span> env <span class="token operator">=></span> <span class="token function">pipe</span><span class="token punctuation">(</span>Either<span class="token punctuation">.</span><span class="token keyword">of</span><span class="token punctuation">,</span> gameLogic<span class="token punctuation">,</span> <span class="token function">runWith</span><span class="token punctuation">(</span>env<span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>\n      </div>\n<p>We import a pointfree version of <code class="language-text">runWith</code> to get out of our Reader. <code class="language-text">gameLogic</code> takes an <code class="language-text">Either</code> and returns a <code class="language-text">Reader</code> that contains an <code class="language-text">Either</code> that holds the result.(<code class="language-text">Reader (Either String String</code>) It calls <code class="language-text">ask</code> to get the environment, and maps over it, chaining <code class="language-text">runTests</code> to the <code class="language-text">either</code> parameter with the environment applied. <code class="language-text">logic</code> simply takes an Int, wraps it in an <code class="language-text">Either</code>, calls <code class="language-text">gameLogic</code> on it, then unwraps the <code class="language-text">Reader</code>, supplying it with the <code class="language-text">env</code> parameter.</p>\n<h4>That all seems logical, but…</h4>\n<p>So, we give <code class="language-text">logic</code> an Int, and it gives us … an <code class="language-text">Either String String</code>? What are we supposed to do with this? We’ll address this in a later post, but for now, here’s a helper function to log out the result, informing us of which side of the <code class="language-text">Either</code> we got.</p>\n<div class="gatsby-highlight">\n      <pre class="language-js"><code class="language-js"><span class="token keyword">const</span> either <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'crocks/pointfree/either\'</span><span class="token punctuation">)</span>\n\n<span class="token comment">// output : Either String String -> ()</span>\n<span class="token keyword">const</span> output <span class="token operator">=</span> <span class="token function">either</span><span class="token punctuation">(</span>\n  str <span class="token operator">=></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`Left: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>str<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n  str <span class="token operator">=></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`Right: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>str<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span>\n<span class="token punctuation">)</span></code></pre>\n      </div>\n<p>Eww, too impure, but we’ll fix that next time. For now, let’s try out our <code class="language-text">logic</code> function with some targets and tolerances.</p>\n<div class="gatsby-highlight">\n      <pre class="language-js"><code class="language-js"><span class="token comment">// env : Env</span>\n<span class="token keyword">const</span> env <span class="token operator">=</span> <span class="token punctuation">{</span>\n  target<span class="token punctuation">:</span> <span class="token number">23</span><span class="token punctuation">,</span>\n  tolerance<span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">logic</span><span class="token punctuation">(</span>env<span class="token punctuation">)</span><span class="token punctuation">,</span> output<span class="token punctuation">)</span></code></pre>\n      </div>\n<p>I know you’re thinking, <em>“I thought you said ‘no global variables.’ What gives?”</em>. Well … ignore that, okay? Purity has its limits. You’re missing the cool part: gotta love composition for those easy helper functions, am I right? Testing our logic is as simple as</p>\n<div class="gatsby-highlight">\n      <pre class="language-js"><code class="language-js"><span class="token function">result</span><span class="token punctuation">(</span><span class="token string">\'a\'</span><span class="token punctuation">)</span>\n<span class="token function">result</span><span class="token punctuation">(</span><span class="token number">101</span><span class="token punctuation">)</span>\n<span class="token function">result</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>\n<span class="token function">result</span><span class="token punctuation">(</span><span class="token number">23</span><span class="token punctuation">)</span>\n<span class="token function">result</span><span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">)</span>\n<span class="token function">result</span><span class="token punctuation">(</span><span class="token number">77</span><span class="token punctuation">)</span></code></pre>\n      </div>\n<p>Results in the terminal are</p>\n<div class="gatsby-highlight">\n      <pre class="language-text"><code class="language-text">&#39;Left: You need to learn to follow instructions&#39;\n&#39;Left: You need to learn to follow instructions&#39;\n&#39;Left: Too Low&#39;\n&#39;Right: Win&#39;\n&#39;Right: Close Enough&#39;\n&#39;Left: Too High&#39;</code></pre>\n      </div>\n<p>And here’s the complete code, for reference</p>\n<div class="gatsby-highlight">\n      <pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token punctuation">{</span> Either<span class="token punctuation">,</span> Reader<span class="token punctuation">,</span> pipe<span class="token punctuation">,</span> pipeK <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'crocks\'</span><span class="token punctuation">)</span>\n<span class="token keyword">const</span> branch <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'crocks/Pair/branch\'</span><span class="token punctuation">)</span>\n<span class="token keyword">const</span> either <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'crocks/pointfree/either\'</span><span class="token punctuation">)</span>\n<span class="token keyword">const</span> runWith <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'crocks/pointfree/runWith\'</span><span class="token punctuation">)</span>\n<span class="token keyword">const</span> <span class="token punctuation">{</span> taggedSum <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'daggy\'</span><span class="token punctuation">)</span>\n<span class="token keyword">const</span> <span class="token punctuation">{</span> Right<span class="token punctuation">,</span> Left <span class="token punctuation">}</span> <span class="token operator">=</span> Either\n\n<span class="token keyword">const</span> Ord <span class="token operator">=</span> <span class="token function">taggedSum</span><span class="token punctuation">(</span><span class="token string">\'Ord\'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n  LT<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n  EQ<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n  GT<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span>\n\n<span class="token comment">// isTolerant : (Int, Int) -> Int -> Eq</span>\n<span class="token keyword">const</span> <span class="token function-variable function">isTolerant</span> <span class="token operator">=</span> <span class="token punctuation">(</span>low<span class="token punctuation">,</span> high<span class="token punctuation">)</span> <span class="token operator">=></span> n <span class="token operator">=></span>\n  n <span class="token operator">&lt;</span> low <span class="token operator">?</span> Ord<span class="token punctuation">.</span>LT <span class="token punctuation">:</span> n <span class="token operator">></span> high <span class="token operator">?</span> Ord<span class="token punctuation">.</span>GT <span class="token punctuation">:</span> Ord<span class="token punctuation">.</span>EQ\n\n<span class="token comment">// firstTest : Int -> Either String Int</span>\n<span class="token keyword">const</span> <span class="token function-variable function">firstTest</span> <span class="token operator">=</span> n <span class="token operator">=></span>\n  <span class="token number">1</span> <span class="token operator">&lt;=</span> n <span class="token operator">&amp;&amp;</span> n <span class="token operator">&lt;=</span> <span class="token number">100</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">isNaN</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span>\n    <span class="token operator">?</span> <span class="token function">Right</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span>\n    <span class="token punctuation">:</span> <span class="token function">Left</span><span class="token punctuation">(</span><span class="token string">\'You need to learn to follow instructions\'</span><span class="token punctuation">)</span>\n\n<span class="token comment">// secondTest : Env -> Int -> Either String Int</span>\n<span class="token keyword">const</span> <span class="token function-variable function">secondTest</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> target<span class="token punctuation">,</span> tolerance <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=></span> n <span class="token operator">=></span>\n  <span class="token function">branch</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span>\n    <span class="token punctuation">.</span><span class="token function">bimap</span><span class="token punctuation">(</span>x <span class="token operator">=></span> x <span class="token operator">-</span> tolerance<span class="token punctuation">,</span> x <span class="token operator">=></span> x <span class="token operator">+</span> tolerance<span class="token punctuation">)</span>\n    <span class="token punctuation">.</span><span class="token function">merge</span><span class="token punctuation">(</span>isTolerant<span class="token punctuation">)</span>\n    <span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span>\n    <span class="token punctuation">.</span><span class="token function">cata</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n      LT<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">Left</span><span class="token punctuation">(</span><span class="token string">\'Too Low\'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n      EQ<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">Right</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">,</span>\n      GT<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">Left</span><span class="token punctuation">(</span><span class="token string">\'Too High\'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span>\n\n<span class="token comment">// thirdTest : Env -> Int -> Either String String</span>\n<span class="token keyword">const</span> <span class="token function-variable function">thirdTest</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> target <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=></span> n <span class="token operator">=></span>\n  target <span class="token operator">===</span> n <span class="token operator">?</span> <span class="token function">Right</span><span class="token punctuation">(</span><span class="token string">\'Win\'</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token function">Right</span><span class="token punctuation">(</span><span class="token string">\'Close Enough\'</span><span class="token punctuation">)</span>\n\n<span class="token comment">// runTests : Env -> Int -> Either String Int</span>\n<span class="token keyword">const</span> <span class="token function-variable function">runTests</span> <span class="token operator">=</span> env <span class="token operator">=></span> <span class="token function">pipeK</span><span class="token punctuation">(</span>firstTest<span class="token punctuation">,</span> <span class="token function">secondTest</span><span class="token punctuation">(</span>env<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">thirdTest</span><span class="token punctuation">(</span>env<span class="token punctuation">)</span><span class="token punctuation">)</span>\n\n<span class="token comment">// gameLogic : Either String Int -> Reader (Either String String)</span>\n<span class="token keyword">const</span> <span class="token function-variable function">gameLogic</span> <span class="token operator">=</span> either <span class="token operator">=></span> Reader<span class="token punctuation">.</span><span class="token function">ask</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>env <span class="token operator">=></span> either<span class="token punctuation">.</span><span class="token function">chain</span><span class="token punctuation">(</span><span class="token function">runTests</span><span class="token punctuation">(</span>env<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n\n<span class="token comment">// logic : Env -> Int -> Either String String)</span>\n<span class="token keyword">const</span> <span class="token function-variable function">logic</span> <span class="token operator">=</span> env <span class="token operator">=></span> <span class="token function">pipe</span><span class="token punctuation">(</span>Either<span class="token punctuation">.</span><span class="token keyword">of</span><span class="token punctuation">,</span> gameLogic<span class="token punctuation">,</span> <span class="token function">runWith</span><span class="token punctuation">(</span>env<span class="token punctuation">)</span><span class="token punctuation">)</span>\n\n<span class="token comment">// output : Either String String -> ()</span>\n<span class="token keyword">const</span> output <span class="token operator">=</span> <span class="token function">either</span><span class="token punctuation">(</span>\n  str <span class="token operator">=></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`Left: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>str<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n  str <span class="token operator">=></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`Right: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>str<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span>\n<span class="token punctuation">)</span>\n\n<span class="token comment">// env : Env</span>\n<span class="token keyword">const</span> env <span class="token operator">=</span> <span class="token punctuation">{</span>\n  target<span class="token punctuation">:</span> <span class="token number">23</span><span class="token punctuation">,</span>\n  tolerance<span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">logic</span><span class="token punctuation">(</span>env<span class="token punctuation">)</span><span class="token punctuation">,</span> output<span class="token punctuation">)</span></code></pre>\n      </div>\n<h4>That’s a lot, Let’s wrap up</h4>\n<p>Damn, that’s some fine logic, But no way to easily interact with it. That’s quite a bit; seems like a good place to stop. The code is working, but it could be cleaner, and we definitely could be using the ADTs to their fuller potentials.</p>\n<p>Next time we’ll do a little refactor of the logic and get a command line interface, so we can actually play the damn thing. Stay tuned!</p>\n<p><em>Errors? Issues? Questions? Contact me via <a href="https://www.twitter.com/digitalsthtcs">Twitter</a> or via <a href="mailto:jason.polhemus@shatteredaesthetic.com">email</a></em></p>',
frontmatter:{path:"/what-the-adt-01",title:"What the ADT 01 - Getting to the Heart of Things",date:"May 06, 2018"}}},pathContext:{slug:"/what-the-adt-01/",previous:{fields:{slug:"/what-the-adt-00/"},frontmatter:{path:"/what-the-adt-00",title:"What the ADT 00 - Introductions All Around"}},next:{fields:{slug:"/what-the-adt-02/"},frontmatter:{path:"/what-the-adt-02",title:"What the ADT 02 - A UI Worth Commanding"}}}}}});
//# sourceMappingURL=path---what-the-adt-01-0f5250cbaa09d4385c47.js.map